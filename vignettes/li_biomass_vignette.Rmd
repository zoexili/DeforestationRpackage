---
title: "Li biomass vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Li biomass vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
#library(ProjectDeforestation)
```

Title: Deforestation and carbon balance in Southern Virginia, U.S. between 1990 and 2000

Summary:A brief (up to 250 words) description of the project, and a bullet point or enumerated list of its primary objectives.

This study intends to understand the connection among deforestation, carbon, and biomass in Virginia. We are interested in how deforestation between 1990 and 2000 affects carbon stock and biomass in Virginia.  

...


Approach and Method: An outline of the analytical methods and code you plan to use, including the names of key packages that you will draw on. This section should be composed of the following sub-sections:

1. Quantifying forest harvest between 1990 and 2000


2. Comparing forest carbon stock change between 1990 and 2000

3. Comparing forest biomass change between 1990 and 2000

3.1 Data pre-processing
```{r}
library(geospaar)
library(rgdal)
library(dplyr)

# install my own package deforestation, run these two lines every time after changing anything in your package. 
# devtools::document()
# devtools::install()

library(deforestation)
# read study area's shapefile
# use relevant paths in the package, not full paths
studyarea <- system.file("extdata/VA_STUDYAREA.shp", package = "deforestation")
studyarea <- st_read(studyarea)
studyarea

# Dataset: NBCD V2 2000
## import raster (FIA ALD biomass)
path1 <- "C:/Users/Li/Desktop/geog_346/NBCD_MZ60_FIA_ALD_biomass/NBCD_MZ60_FIA_ALD_biomass.tif"
biomass1 <- raster(path1)
biomass1
plot(biomass1)

path2 <- "C:/Users/Li/Desktop/geog_346/NBCD_MZ59_FIA_ALD_biomass/NBCD_MZ59_FIA_ALD_biomass.tif"
biomass2 <- raster(path2)
biomass2
plot(biomass2, add = TRUE)

## Reproject study area shapefile
studyarea_nad83 <- st_transform(x = studyarea, crs = crs(biomass1))
studyarea_nad83
par(mar = rep(0,4))
plot(studyarea_nad83[6], add = TRUE)

## Merge rasters
biomass_merge <- merge(biomass1, biomass2)
biomass_merge
plot(biomass_merge)

## crop raster
biomass_crop <- crop(x = biomass_merge, y = studyarea_nad83)
biomass_crop
plot(biomass_crop)
plot(st_geometry(studyarea_nad83), col = rgb(1, 1, 1, alpha = 0), add = TRUE)

## mask raster
biomass_clip <- raster::mask(x = biomass_crop, mask = studyarea_nad83)
plot(biomass_clip)

## write raster into a new tif and save it in extdata/ 
writeRaster(biomass_clip, 
            filename = file.path("inst/extdata/", "biomass_FIA_ALD_2000.tif"))
biomass_FIA_ALD2000 <- raster(
  file.path("inst/extdata/", "biomass_FIA_ALD_2000.tif")
)
plot(biomass_FIA_ALD2000)

# Dataset: Forest Carbon Stocks and Fluxes After Disturbance, SE US
## import raster
path3 <- "C:/Users/Li/Desktop/geog_346/agb_1990.tif"
biomass3 <- raster(path3)
biomass3
plot(biomass3)

path4 <- "C:/Users/Li/Desktop/geog_346/agb_2000.tif"
biomass4 <- raster(path4)
biomass4
plot(biomass4)

## crop raster 
biomass3_crop <- crop(x = biomass3, y = studyarea_nad83)
biomass3_crop
plot(biomass3_crop)
plot(st_geometry(studyarea_nad83), col = rgb(1, 1, 1, alpha = 0), add = TRUE)

biomass4_crop <- crop(x = biomass4, y = studyarea_nad83)
biomass4_crop
plot(biomass4_crop)

## mask raster
biomass3_clip <- raster::mask(x = biomass3_crop, mask = studyarea_nad83)
plot(biomass3_clip)

biomass4_clip <- raster::mask(x = biomass4_crop, mask = studyarea_nad83)
plot(biomass4_clip)

# write rasters into extdata/
writeRaster(biomass3_clip, filename = file.path("inst/extdata/", "agb1990.tif"))
agb1990 <- raster(file.path("inst/extdata/", "agb1990.tif"))
plot(agb1990)

writeRaster(biomass4_clip, filename = file.path("inst/extdata/", "agb2000.tif"))
agb2000 <- raster(file.path("inst/extdata/", "agb2000.tif"))
plot(agb2000)

```

3.2 Table & bar graph: List total quantities of AGB (kg C m-2 y-1) of harvested forest area in 1990 and 2000, over six counties. 
```{r}
# 1990
## create empty raster in study area's extent and fill in value
zonal_ras <- raster(x = extent(studyarea_nad83), crs = crs(studyarea_nad83), res = 30)
values(zonal_ras) <- 1:ncell(zonal_ras)

## convert vector to raster
studyarea_nad83_ras <- studyarea_nad83 %>% rasterize(x = ., y = zonal_ras) 
plot(studyarea_nad83_ras)

## zonal statistics
### resample studyarea_nad83_ras to the parameters of agb1990, so the extent matches between data. 
studyarea_nad83_ras_rs <- resample(x = studyarea_nad83_ras, y = agb1990, method = "ngb")
plot(studyarea_nad83_ras_rs)
zonal_agb1990 <- zonal(x = agb1990, z = studyarea_nad83_ras_rs, fun = "sum") 
plot(zonal_agb1990)

## convert list to matrix and change row/col names
zonal_agb1990_m <- as.matrix(zonal_agb1990)
colnames(zonal_agb1990_m) <- c("Zone", "AGB of total forest land (Kg C m-2)")
rownames(zonal_agb1990_m) <- studyarea_nad83$NAME


## table
zonal_agb1990_m

## bar graph
barplot(zonal_agb1990_m[,2], main="AGB of total forest land 1990", ylab = colnames(zonal_agb1990_m)[2])

# 2000
studyarea_nad83_ras_rs2000 <- resample(x = studyarea_nad83_ras, y = agb2000, method = "ngb")
plot(studyarea_nad83_ras_rs2000)
zonal_agb2000 <- zonal(x = agb2000, z = studyarea_nad83_ras_rs, fun = "sum") 
plot(zonal_agb2000)

zonal_agb2000_m <- as.matrix(zonal_agb2000)
colnames(zonal_agb2000_m) <- c("Zone", "AGB of total forest land (Kg C m-2)")
rownames(zonal_agb2000_m) <- studyarea_nad83$NAME
zonal_agb2000_m
barplot(zonal_agb2000_m[,2], main="AGB of total forest land 2000", ylab = colnames(zonal_agb2000_m)[2])

```



4. Examine the connections among forest harvest, forest carbon stock change, and biomass change between 1990 and 2000 

5. Web-mapping (visulization) 
shiny 
leaflet 
```{r}

```


Data: A brief (~250 words) description and visualization of the datasets you will be using. That means spatial plots of the main datasets and their key values, and, as a bonus, a plot of summary statistics, e.g. a histogram or boxplot of one of the more importants variables in the dataset.

NAFD: North American forest dynamics
MTBS: the Monitoring Trends in Burn Severity
Forest Carbon Stocks and Fluxes After Disturbance, Southeastern USA, 1990-2010
NBCD: NACP Aboveground Biomass and Carbon Baseline Data, V[ersion]. 2

Code: A bullet point summary of the analysis and coding approach that you propose to follow. For teams, this section should include a description of which member will be responsible for each bullet point.

(Remember to save output to PNG file, so it saves time of processing)

Timelines: Provide a timeline for when each portion of the analysis will be completed. These timelines should be constructed relative to the time period of presentations (during the last two weeks of class) and final project submission (during exam week). For teams, names should be associated with each step on the timeline.




Anticipated outcomes: Briefly describe, as bullet points, the outcomes you expect for each of your primary project objectives


